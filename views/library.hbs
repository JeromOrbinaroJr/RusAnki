<i class="large material-icons icon-spacing">book</i>
<div class="container">
    {{#each decks}}
        <div class="deck-container">
            <h2>{{this.name}}</h2>
            <div class="carousel">
                {{#each this.cards}}
                    <a class="carousel-item" href="#{{../this.name}}!">
                        <div class="flashcard-small">
                            <div class="flashcard-inner-small">
                                <div class="flashcard-front-small">
                                    <p>{{this.question}}</p>
                                </div>
                                <div class="flashcard-back-small">
                                    <p>{{this.answer}}</p>
                                </div>
                            </div>
                        </div>
                    </a>
                {{/each}}
                {{#unless this.cards.length}}
                    <a class="carousel-item" href="#!">
                        <div class="flashcard-small">
                            <div class="flashcard-inner-small">
                                <div class="flashcard-front-small">
                                    <p>Нет карточек</p>
                                </div>
                                <div class="flashcard-back-small">
                                    <p>Добавьте карточки</p>
                                </div>
                            </div>
                        </div>
                    </a>
                {{/unless}}
            </div>
            <div class="btn-container">
                <a href="/library/deck/{{this.id}}" class="btn">Просмотр колоды</a>
                <button class="btn publish-deck">Публикация колоды</button>
                <button class="btn delete-deck" data-id="{{this.id}}">Удалить колоду</button>
                <div class="publish-form hidden">
                    <form action="/library/publish/{{this.id}}" method="POST">
                        <input type="text" name="theme" placeholder="Тема">
                        <input type="text" name="direction" placeholder="Направление">
                        <button type="submit" class="btn">Опубликовать в общем репозитории</button>
                    </form>
                </div>
            </div>
        </div>
    {{/each}}
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const publishButtons = document.querySelectorAll('.publish-deck');
        
        publishButtons.forEach(button => {
            button.addEventListener('click', function() {
                const parentDeck = button.closest('.deck-container');
                const publishForm = parentDeck.querySelector('.publish-form');
                publishForm.classList.toggle('visible');
            });
        });

        const deleteButtons = document.querySelectorAll('.delete-deck');

        deleteButtons.forEach(button => {
            button.addEventListener('click', function() {
                const deckId = button.getAttribute('data-id');
                if (confirm('Вы уверены, что хотите удалить эту колоду?')) {
                    fetch(`/library/delete/${deckId}`, {
                        method: 'DELETE'
                    }).then(response => {
                        if (response.ok) {
                            location.reload();
                        } else {
                            alert('Ошибка при удалении колоды');
                        }
                    });
                }
            });
        });

        const elems = document.querySelectorAll('.carousel');
        M.Carousel.init(elems, {
            fullWidth: false,
            indicators: true,
            padding: 20,
            numVisible: 5,
            shift: 0,
        });
    });
</script>

<link href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
